{% extends "base.html" %}
{% block title %}Insights{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-6">
    <div class="card p-3 shadow-sm">
      <h5>Attrition Overview</h5>
      <canvas id="attritionChart"></canvas>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card p-3 shadow-sm">
      <h5>Attrition by Job Role (counts)</h5>
      <canvas id="roleChart"></canvas>
    </div>
  </div>
</div>

<script>
const ctx = document.getElementById('attritionChart').getContext('2d');
new Chart(ctx, {
  type: 'pie',
  data: {
    labels: ['Stay', 'Leave'],
    datasets: [{
      data: [{{ stay_count }}, {{ leave_count }}],
      backgroundColor: ['#4CAF50', '#F44336']
    }]
  }
});

const roleCtx = document.getElementById('roleChart').getContext('2d');
const roleLabels = {{ job_counts|map(attribute='JobRole')|list|tojson }};
const roleCounts = {{ job_counts|map(attribute='count')|list|tojson }};
new Chart(roleCtx, {
  type: 'bar',
  data: {
    labels: roleLabels,
    datasets: [{
      label: 'Employees',
      data: roleCounts
    }]
  },
  options: { indexAxis: 'y' }
});
</script>
{% endblock %}
